bundle:
  name: dbx-bundle-poc

# (root_path is optional; keeping it only for bundle state)
workspace:
  root_path: /Workspace/Users/rohitazure9@gmail.com/.bundle/${bundle.name}/${bundle.target}

variables:
  catalog:
    default: hive_metastore
  schema:
    default: demo

resources:
  jobs:
    etl_demo_job:
      name: ${bundle.name}-${bundle.target}-etl
      tags:
        env: ${bundle.target}

      job_clusters:
        - job_cluster_key: jc
          new_cluster:
            spark_version: "13.3.x-scala2.12"
            node_type_id: "Standard_DS3_v2"
            num_workers: 1
            data_security_mode: SINGLE_USER

      tasks:
        - task_key: create_demo_table
          job_cluster_key: jc
          notebook_task:
            # ðŸ‘‡ run from the repo snapshot (no workspace copy needed)
            source: GIT
            notebook_path: notebooks/00_create_demo_table.sql
            base_parameters:
              catalog: ${var.catalog}
              schema: ${var.schema}

        - task_key: etl_demo
          depends_on:
            - task_key: create_demo_table
          job_cluster_key: jc
          notebook_task:
            source: GIT
            notebook_path: notebooks/10_etl_demo.py
            base_parameters:
              catalog: ${var.catalog}
              schema: ${var.schema}

        - task_key: transform_sales
          depends_on:
            - task_key: etl_demo
          job_cluster_key: jc
          notebook_task:
            source: GIT
            notebook_path: notebooks/20_transform_sales.sql
            base_parameters:
              catalog: ${var.catalog}
              schema: ${var.schema}

targets:
  dev:
    default: true
    variables:
      catalog: hive_metastore
      schema: demo_dev
    resources:
      jobs:
        etl_demo_job:
          name: ${bundle.name}-dev-etl

  qa:
    variables:
      catalog: hive_metastore
      schema: demo_qa

  prod:
    variables:
      catalog: hive_metastore
      schema: demo_prod
