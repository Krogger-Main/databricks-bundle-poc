bundle:
  name: dbx-bundle-poc

workspace:
  # Where bundle files will be copied to in the workspace
  root_path: /Shared/${bundle.name}/${bundle.target}
  files:
    - source: notebooks
      destination: ${workspace.root_path}/notebooks

# Reusable variables (overridden per-target in conf/*.yml)
variables:
  catalog:
    default: hive_metastore    # set to 'main' if using UC
  schema:
    default: demo

resources:
  jobs:
    etl_demo_job:
      name: ${bundle.name}-${bundle.target}-etl
      tags:
        env: ${bundle.target}
      tasks:
        - task_key: create_demo_table
          notebook_task:
            notebook_path: ${workspace.root_path}/notebooks/00_create_demo_table.sql
            source: WORKSPACE
            base_parameters:
              catalog: ${var.catalog}
              schema:  ${var.schema}
          job_cluster_key: jc

        - task_key: etl_demo
          depends_on:
            - task_key: create_demo_table
          notebook_task:
            notebook_path: ${workspace.root_path}/notebooks/10_etl_demo.py
            source: WORKSPACE
            base_parameters:
              catalog: ${var.catalog}
              schema:  ${var.schema}
          job_cluster_key: jc

        - task_key: transform_sales
          depends_on:
            - task_key: etl_demo
          notebook_task:
            notebook_path: ${workspace.root_path}/notebooks/20_transform_sales.sql
            source: WORKSPACE
            base_parameters:
              catalog: ${var.catalog}
              schema:  ${var.schema}
          job_cluster_key: jc

      job_clusters:
        - job_cluster_key: jc
          new_cluster:
            spark_version: "13.3.x-scala2.12"    # pick any supported LTS
            node_type_id: "Standard_DS3_v2"      # any small node type for POC
            num_workers: 1
            data_security_mode: SINGLE_USER

targets:
  dev:
    default: true
    variables:
      catalog: hive_metastore   # or 'main' if UC
      schema: demo_dev
    overrides:
      # Example of per-env tweaks
      resources.jobs.etl_demo_job.name: ${bundle.name}-dev-etl

  qa:
    variables:
      catalog: hive_metastore
      schema: demo_qa

  prod:
    variables:
      catalog: hive_metastore
      schema: demo_prod
